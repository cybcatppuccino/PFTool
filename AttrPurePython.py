'''
(2, '', '4.31', 'This is operator "4.31" from ...') (64*z - 1)**2*(108*z - 1)**2
(3, '60', '4.26', 'Sporadic YY-Operator') (16*z - 1)**2*(108*z - 1)**2
(22, '~37', '4.13', 'YY-Operator equivalent to AESZ 37$=C \\ast \\alpha ~tilde c \\ast i$') (256*z - 1)**2*(1024*z - 1)**2
(29, '356\n', '4.32', 'Sporadic YY-Operator.') (108*z - 1)**2*(128*z - 1)**2
(34, '', '4.35', 'Operator equivalent to 3.34, equivalent to') -(16*z + 1)*(128*z - 1)**3
(44, '276', '4.55', 'Sporadic Operator.') (110592*z - 1)**2*(331776*z - 1)**2
(51, '255', '4.29', 'Sporadic YY-Operator.') (256*z + 1)**4
(86, '189', '4.27', 'Sporadic YY-Operator') (4*z - 1)**2*(256*z - 1)**2
(90, '~39', '4.1', 'YY-Operator equivalent to AESZ 39=$A \\ast \\alpha$.') (64*z - 1)**2*(256*z - 1)**2
(105, '353', '4.71', 'Sporadic Operator, reducible to 3.33, so not a primary operator.') (16*z - 1)*(64*z - 1)**3
(128, '', '4.7', 'YY-operator equivalent to (:AESZ 50), $\\tilde B \\ast \\alpha$') (108*z - 1)**2*(432*z - 1)**2
(129, '254', '4.49', 'Sporadic Operator.') (4096*z - 1)*(6912*z - 1)*(15360*z - 1)**2
(159, '~66', '4.19', 'YY-Operator equivalent to $AESZ 66 =$D \\ast \\alpha \\tilde c \\ast j$') (1728*z - 1)**2*(6912*z - 1)**2
(177, '', '4.77', 'Sporadic Operator.') (16*z - 1)**2*(24*z - 1)*(25*z - 1)
(182, '244', '4.28', 'Sporadic YY-Operator') (4*z - 1)**2*(108*z + 1)**2
(243, '239', '4.47', 'Sporadic Operator.') -(432*z + 1)*(1728*z + 1)**2*(3456*z - 1)
(260, '', '4.70', 'Sporadic Operator. There is a second') (20736*z - 1)*(65536*z - 1)*(221184*z + 1)**2
(299, '237', '4.46', 'This is operator "4.46" from ...') (64*z - 1)*(96*z + 1)**2*(864*z - 1)
(325, '278', '4.57', 'Sporadic Operator.') (162*z + 1)**2*(432*z - 1)*(729*z - 1)
(378, '241', '4.48', 'Sporadic Operator.') -(64*z + 1)*(384*z - 1)**2*(1728*z - 1)
(392, '288', '4.60', 'Sporadic Operator.') (1536*z + 1)**2*(4096*z - 1)*(6912*z - 1)
(398, '264', '4.53', 'Sporadic Operator.') (4096*z - 1)*(27648*z - 1)*(43008*z + 1)**2
(420, '277', '4.56', 'Sporadic Operator. There is a second MUM-point hiding at') -(1024*z + 1)*(4096*z - 1)*(6144*z + 1)**2
(439, '258', '4.52', 'Sporadic Operator.') (256*z - 1)*(512*z + 1)**2*(1024*z - 1)
(441, '350', '4.69', 'Sporadic Operator. There is a second MUM-point hiding at infinity, corresponding to Operator AESZ 351/4.70') (24*z + 1)**2*(81*z - 1)*(256*z - 1)
(478, '', '4.76', 'Sporadic Operator.') -(27*z + 1)*(2592*z + 1)**2*(13824*z - 1)
(523, '233', '4.45', 'Sporadic Operator.') (192*z - 1)**2*(432*z - 1)*(512*z - 1)
(529, '289', '4.61', 'Sporadic Operator.') (256*z - 1)*(5120*z + 1)**2*(16384*z - 1)
'''

'''
(7, '143', '2.30', '$D\\ast h^{\\tilde{\\;}}B\\ast\\kappa$') (11664*z - 1)**2
(8, '~82', '2.45', 'Operator equivalent to $\\hat{8}$') (46656*z - 1)**2
(17, '406', '2.68', 'This is operator "2.68" from ...') (256*z - 1)**2
(27, '~94', '2.48', 'Operator equivalent to $\\hat{11}$') (6912*z - 1)**2
(38, '', '2.33', 'This is operator "2.33" from ...') (4096*z - 1)**2
(45, '', '2.66', 'This is operator "2.66" from ...') (432*z - 1)**2
(54, '', '2.50', 'Operator equivalent to $\\hat{13}$ of AESZ') (746496*z - 1)**2
(66, '~80,~81', '2.39', 'Operator equivalent to $\\hat{1}$ of AESZ') (12500*z - 1)**2
(68, '', '2.37', 'Hadamard product $B\\ast c$.') (27648*z - 1)**2
(73, '', '2.49', 'Operator equivalent to $\\hat{12}$') (110592*z - 1)**2
(75, '', '2.46', 'Operator equivalent to $\\hat{9}$') (11943936*z - 1)**2
(81, '~98', '2.42', 'Operator equivalent to $\\hat{5}$') (1728*z - 1)**2
(82, '112', '2.19', '>console.log("JSON Response:")') (6912*z - 1)**2
(98, '', '2.47', 'Operator equivalent to $\\hat{10}$') (16384*z - 1)**2
(100, '', '2.36', 'This is operator "2.36" from ...') (11664*z - 1)**2
(102, '47', '2.59', 'Hadamard product $I \\ast \\kappa$') (1728*z - 1)**2
(104, '', '2.34', 'This is operator "2.34" from ...') (27648*z - 1)**2
(106, '84', '2.63', 'This is operator "2.63" from ...') (64*z - 1)**2
(107, '183', '2.65', 'This is operator "2.65" from ...') (48*z + 1)*(64*z + 1)
(113, '61', '2.38', 'This is operator "2.38" from ...') (186624*z - 1)**2
(126, '', '2.41', 'Operator equivalent to $\\hat{4}$') (2916*z - 1)**2
(131, '~88,~89', '2.51', 'Operator equivalent to $\\widehat{14}$') (27648*z - 1)**2
(132, '', '2.44', 'Operator equivalent to $\\hat{7}$') (262144*z - 1)**2
(133, '46', '2.58', 'Hadamard product $I \\ast \\iota$') (108*z - 1)**2
(134, '245', '2.67', 'This is operator "2.67" from ...') (108*z - 1)**2
(144, '~77,~78,~97', '2.43', 'Operator equivalent to $\\hat{6}$') (4096*z - 1)**2
(149, '', '2.40', 'Operator equivalent to $\\hat{2}$ of AESZ.') (3200000*z - 1)**2
(176, '205', '2.69', 'This is operator "2.69" from ...') (27*z - 1)*(32*z - 1)
(178, '182', '2.64', 'This is operator "2.64" from ...') (16*z - 1)*(27*z - 1)
(184, '26', '2.61', 'A-incarnation: $X(1,1,1,1,2) \\subset  Grass(2,6)$') -(4*z + 1)*(108*z - 1)
(194, '140', '2.27', 'Hadamard product $D \\ast g$') (3456*z - 1)*(3888*z - 1)
(217, '45', '2.1', 'Hadamard product $A \\ast a$, where $A$ is (:case 2.1.1)') -(16*z + 1)*(128*z - 1)
(245, '58', '2.9', 'Hadamard product A*c') (16*z - 1)*(144*z - 1)
(246, '36', '2.13', 'A*d') (64*z - 1)*(128*z - 1)
(291, '137', '2.24', 'Hadamard product $A \\ast g$.') (128*z - 1)*(144*z - 1)
(292, '', '2.70', 'Operator equivalent to (:aesz 255)') (256*z - 1)**2
(301, '15', '2.2', 'Hadamard product $B\\ast a$.') -(27*z + 1)*(216*z - 1)
(320, '48', '2.14', 'B*d') (108*z - 1)*(216*z - 1)
(322, '65', '2.16', 'Hadamard product D*d') (1728*z - 1)*(3456*z - 1)
(343, '70', '2.10', 'Hadamard product $B\\ast c$.') (27*z - 1)*(243*z - 1)
(344, '138', '2.25', 'Hadamard product $B\\ast g$.') (216*z - 1)*(243*z - 1)
(371, '111', '2.17', 'B-Incarnations:') (256*z - 1)**2
(390, '110', '2.18', '>console.log("JSON Response:")') (432*z - 1)**2
(397, '62', '2.4', 'Hadamard product D*a') -(432*z + 1)*(3456*z - 1)
(411, '18', '2.60', 'A-Incarnation: (1,1) and (2,2) intersection in $P^3 \\times P^3$') -(16*z + 1)*(64*z - 1)
(414, '16', '2.52', 'Hadamard product $I \\ast \\alpha$') (16*z - 1)*(64*z - 1)
(422, '64', '2.12', 'Hadamard product $B\\ast c$.') (432*z - 1)*(3888*z - 1)
(423, '139', '2.26', 'Hadamard product $C \\ast g$') (512*z - 1)*(576*z - 1)
(426, '142', '2.29', 'Hadamard product $A \\ast$') (729*z - 1)**2
(435, '49', '2.28', 'Hadamard product $A \\ast$') (432*z - 1)**2
(437, '38', '2.15', 'Hadamard product $C\\ast d$') (256*z - 1)*(512*z - 1)
(438, '~67', '2.35', 'This is operator "2.35" from ...') (6912*z - 1)**2
(446, '28', '2.62', 'A-incarnation: $X(1, 1, 1, 1, 1, 1) \\subset  Grass(3, 6)$') (z - 1)*(64*z - 1)
(454, '68', '2.3', 'C*a') -(64*z + 1)*(512*z - 1)
(477, '', '2.32', 'This is operator "2.32" from ...') (1728*z - 1)**2
(484, '69', '2.11', 'Hadamard product $C\\ast c$') (64*z - 1)*(576*z - 1)
(548, '7**', '2.31', 'This operator replaces AESZ 43, to which it is equivalent.') (1024*z - 1)**2
'''

#thelist = [411, 133, 194, 217, 245, 291, 301, 322, 343, 344, 397, 414, 422, 423, 426, 435, 437, 484]
#thelist = [2,420,3,22,29,34,44,51,86,90,105,128,129,159,177,182,243,260,299,325,378,392,398,439,441,478,523,529]
#thelist = [243,260,299,325,378,392,398,439,441,478,523,529]
#thelist = [17, 27, 38, 45, 54, 66, 68, 73, 75, 81, 82, 98, 100, 102, 104, 107, 113, 126, 131, 132, 133, 134, 144, 149, 176, 178, 184, 194, 217, 245, 291, 301, 320, 322, 343, 344, 371, 390, 397, 411, 414, 422, 423, 426, 435, 437, 438, 446, 454, 477, 484, 548]
#thelist = [23, 89, 135, 142, 162, 165, 175, 185, 188, 219, 224, 227, 247, 254, 272, 278, 284, 334, 338, 342, 359, 384, 395, 408, 425, 447, 489, 493, 500, 539, 550]

thelist = [2, 3, 7, 8, 10, 17, 22, 23, 26, 27, 29, 34, 35, 38, 40, 41, 44, 45, 50, 51, 54, 60, 66, 68, 70, 73, 75, 79, 81, 82, 86, 87, 89, 90, 98, 100, 102, 103, 104, 105, 106, 107, 111, 113, 115, 126, 128, 129, 131, 132, 133, 134, 135, 137, 142, 144, 147, 148, 149, 153, 156, 159, 162, 165, 175, 176, 177, 178, 182, 184, 185, 188, 194, 197, 202, 203, 204, 205, 214, 217, 219, 221, 224, 227, 228, 229, 231, 243, 245, 246, 247, 254, 258, 259, 260, 265, 268, 272, 274, 278, 284, 291, 292, 299, 301, 320, 322, 325, 334, 338, 342, 343, 344, 350, 359, 360, 364, 371, 377, 378, 384, 386, 390, 392, 395, 397, 398, 399, 402, 408, 411, 414, 415, 417, 420, 422, 423, 425, 426, 430, 435, 437, 438, 439, 440, 441, 444, 446, 447, 451, 452, 454, 459, 477, 478, 480, 481, 482, 483, 484, 489, 493, 500, 510, 521, 523, 529, 530, 531, 535, 539, 548, 550]

import AESZ
import PFTool
import sympy
import mpmath
from LLL import reduction

for num in thelist:
    pfo = AESZ.AESZ(num).pfo
    disc = pfo.discriminant
    solveinv = [1/_ for _ in sympy.solve(disc)]
    lcm = sympy.lcm([abs(_) for _ in solveinv])
    solveinv.append(0)
    solveinv.sort()
    factorint = sympy.factorint(lcm)
    def factors(indic):
        # return all factors of an integer by its prime factorization
        if len(indic) == 0:
            return [1]
        indicnew = indic.copy()
        p = list(indicnew.keys())[-1]
        e = indicnew.pop(p)
        f = factors(indicnew)
        outlst = []
        for i in range(int(e + 1)):
            outlst += [p ** i * _ for _ in f]
        return outlst
    allfactorspos = factors(factorint)
    allfactors = [-_ for _ in allfactorspos] + allfactorspos
    allfactors.sort()

    def invinterval(x, y):
        if x is None:
            return (None if y == 0 else 1/sympy.Integer(y), 0)
        if y is None:
            return (0, None if x == 0 else 1/sympy.Integer(x))
        return (None if y == 0 else 1/sympy.Integer(y), None if x == 0 else 1/sympy.Integer(x))

    for n in range(-1, len(solveinv)):
        piece = []
        for _ in allfactors:
            if n == -1 and _ < solveinv[0]:
                piece.append((1/sympy.Integer(_), invinterval(None, solveinv[0])))
            elif n == len(solveinv)-1 and _ > solveinv[-1]:
                piece.append((1/sympy.Integer(_), invinterval(solveinv[-1], None)))
            elif _ > solveinv[n] and _ < solveinv[n+1]:
                piece.append((1/sympy.Integer(_), invinterval(solveinv[n], solveinv[n+1])))
        piece.sort(key=lambda x: x[0])

        def LLLtest(mat):
            ls = list((mat ** -1) * mpmath.matrix([[1], [0], [0], [0]]))
            tpj = 2 * mpmath.pi * mpmath.j
            vals = [mpmath.zeta(3), tpj ** 3, tpj ** 2, tpj ** 1]
            tol = 10**(12 - mpmath.mp.dps)
            ls2 = [mpmath.re(ls[0]*vals[0]), mpmath.re(ls[0]*vals[1]), mpmath.re(ls[1]*vals[2]), mpmath.re(ls[2]*vals[3]), mpmath.re(ls[3]), \
                mpmath.im(ls[0]*vals[0]), mpmath.im(ls[0]*vals[1]), mpmath.im(ls[1]*vals[2]), mpmath.im(ls[2]*vals[3]), mpmath.im(ls[3])]
            ls3 = []
            for _ in ls2:
                if abs(_) > tol:
                    ls3.append(_)
            l = len(ls3)
            llllst = [[int(a==b) + int(ls3[a] * 10**(mpmath.mp.dps - 12)) * int(b==l) for b in range(l+1)] for a in range(l)]
            return ls2, reduction(llllst)
        
        def LLLtest2(mat):
            ls = list((mat ** -1) * mpmath.matrix([[1], [0], [0], [0]]))
            tpj = 2 * mpmath.pi * mpmath.j
            vals = [mpmath.zeta(3), tpj ** 3, tpj ** 2, tpj ** 1]
            ls2 = [mpmath.re(ls[0]*vals[0]), mpmath.re(ls[0]*vals[1]), mpmath.re(ls[1]*vals[2]), mpmath.re(ls[2]*vals[3]), mpmath.re(ls[3]), \
                mpmath.im(ls[0]*vals[0]), mpmath.im(ls[0]*vals[1]), mpmath.im(ls[1]*vals[2]), mpmath.im(ls[2]*vals[3]), mpmath.im(ls[3])]
            l = len(ls2) // 2
            llllst = [[int(a==b) + int(ls2[a] * 10**(mpmath.mp.dps - 12)) * int(b==l) + int(ls2[a + l] * 10**(mpmath.mp.dps - 12)) * int(b==l+1) for b in range(l+2)] for a in range(l)]
            return ls2, reduction(llllst)
        
        def genzlist(pt1, pt2):
            zlist = []
            znow = pt1[0]
            while znow < pt2[0]:
                zlist.append(znow)
                if pt1[1][0] is None:
                    znow += PFTool.approx((pt1[1][1] - znow) / 5)
                elif pt1[1][1] is None:
                    znow += PFTool.approx((znow - pt1[1][0]) / 4)
                else:
                    znow += PFTool.approx(min((pt1[1][1] - znow) / 5, (znow - pt1[1][0]) / 4))
            zlist.append(pt2[0])
            print(zlist)
            return zlist
        
        def is_attr(rst2):
            s1 = sum(abs(_) for _ in rst2[0]) < 10**5
            s2 = sum(abs(_) for _ in rst2[1]) < 10**5
            s3 = sum(abs(_) for _ in rst2[2]) < 10**5
            s4 = sum(abs(_) for _ in rst2[3]) < 10**5
            s5 = min(abs(_) for _ in rst2[0]) < 10**3
            s6 = min(abs(_) for _ in rst2[1]) < 10**3
            s7 = min(abs(_) for _ in rst2[2]) < 10**3
            s8 = min(abs(_) for _ in rst2[3]) < 10**3
            return s1 and s2 and s3 and s4 and s5 and s6 and s7 and s8

        if len(piece) > 0:
            print(num, disc, piece)

            #'''

            mat = pfo.eval_Wronskian0(piece[0][0], pr=True)
            rst1, rst2 = LLLtest(mat)
            outstr = ""
            rst4 = None
            if is_attr(rst2):
                rst3, rst4 = LLLtest2(mat)
                print("Attr!", num, piece[0][0], rst2, rst4)
                outstr = "Attr_"
            with open('results/' + outstr + str(num) + '_' + str(piece[0][0]).replace('/', 'd') + '.txt', 'w') as f:
                f.write(PFTool.mptomma(mat ** -1) + '\n' + str(rst2) + '\n' + str(rst4))
            
            for i in range(1, len(piece)):
                zlist = genzlist(piece[i-1], piece[i])
                mat = PFTool.hololist(pfo, zlist, 128) * mat
                rst1, rst2 = LLLtest(mat)
                outstr = ""
                rst4 = None
                if is_attr(rst2):
                    rst3, rst4 = LLLtest2(mat)
                    print("Attr!", num, piece[i][0], rst2, rst4)
                    outstr = "Attr_"
                with open('results/' + outstr + str(num) + '_' + str(piece[i][0]).replace('/', 'd') + '.txt', 'w') as f:
                    f.write(PFTool.mptomma(mat ** -1) + '\n' + str(rst2) + '\n' + str(rst4))

            #'''

'''

pfo = AESZ.AESZ(447).pfo
z0 = sympy.Integer(1)/8
#print(pfo.eval_attr_Wronskian_MMA(z0, pr=True))

print(pfo.eval_attr_LLL(z0, pr=True))

'''